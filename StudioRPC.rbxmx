<roblox xmlns:xmime="http://www.w3.org/2005/05/xmlmime" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.roblox.com/roblox.xsd" version="4">
	<External>null</External>
	<External>nil</External>
	<Item class="Script" referent="RBX0F0B8CF4A2C746B2BE01F6B24DF9F801">
		<Properties>
			<ProtectedString name="Source"><![CDATA[--[[ 
    Roblox Studio RPC Plugin
    Author: PrayoadMii
--]]

local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local ServerURL = "http://127.0.0.1:2500/API/RpcUpload"
local PluginPackageId = "rbx.prayoadmii.StudioRPC"

--// Toolbar Button
local toolbar = plugin:CreateToolbar("Studio Chat")
local ToggleButton = toolbar:CreateButton(
	"Studio RPC",
	"Check Did You're Running Server Or Not If Icon Is Red",
	"rbxassetid://132676871546283"
)

-- ดึง Avatar URL จาก userId
local function GetThumbnailsFromId(Id:number)
	local url = ("https://thumbnails.roproxy.com/v1/users/avatar-headshot?userIds=%d&size=100x100&format=Png&isCircular=true"):format(Id)
	local success, response = pcall(function()
		return HttpService:GetAsync(url)
	end)
	if success then
		local data = HttpService:JSONDecode(response)
		return data.data[1].imageUrl
	else
		return nil
	end
end

local function GetPlaceThumbnail(placeId:number)
	local url = ("https://thumbnails.roproxy.com/v1/places/gameicons?placeIds=%d&size=150x150&format=Png"):format(placeId)
	local success, response = pcall(function()
		return HttpService:GetAsync(url)
	end)
	if success then
		local data = HttpService:JSONDecode(response)
		if data and data.data and data.data[1] then
			return data.data[1].imageUrl
		end
	end
	return nil
end

-- ส่งข้อมูล RPC ไป Python Flask Server
local function SendRPCToServerAsync(Line1, Line2, BigImage, BigImageTip, SmallImage, SmallImageTip)
	local DataToSendToServer = {
		Details = Line1 or nil,
		State = Line2 or nil,
		LargeImage = BigImage or nil,
		SmallImage = SmallImage or nil,
		BigImageToolHover = BigImageTip or nil,
		SmallImageHover = SmallImageTip or nil
	}
	local success, err = pcall(function()
		HttpService:PostAsync(ServerURL, HttpService:JSONEncode(DataToSendToServer), Enum.HttpContentType.ApplicationJson)
	end)
	if not success then
		ToggleButton.Icon = "rbxassetid://117554232976059"
	else
		ToggleButton.Icon = "rbxassetid://117636057142584"
	end
end

local function GetGameName() :string
	local susess, resault = pcall(function()
		return game:GetService("MarketplaceService"):GetProductInfo(game.PlaceId)
	end)
	if susess then
		return resault.Name
	else
		return "Untitled Place"
	end
end

local function GetItem()
	local selected = game:GetService("Selection"):Get()
	if #selected > 1 then
		return selected[1].Name .. " And Others " .. #selected .. " Instances"
	elseif #selected > 0 then
		return selected[1].Name
	else
		return "Nothing"
	end
end

-- ฟังก์ชันหลัก อัปเดตทุก 5 วินาที
task.spawn(function()
	while task.wait(2.5) do
		local player = Players.LocalPlayer
		if player then
			local avatarUrl = GetThumbnailsFromId(player.UserId)
			SendRPCToServerAsync(
				GetGameName(),           -- Details
				GetItem(),         -- State
				GetPlaceThumbnail(game.PlaceId),                     -- LargeImage
				GetGameName(),                 -- LargeImage hover
				avatarUrl,                     -- SmallImage
				"Editing As: " .. player.DisplayName            -- SmallImage hover
			)
		end
	end
end)]]></ProtectedString>
			<bool name="Disabled">false</bool>
			<Content name="LinkedSource"><null></null></Content>
			<token name="RunContext">0</token>
			<string name="ScriptGuid">{D2DDE299-88D2-47D8-A25E-C92EA5773C17}</string>
			<BinaryString name="AttributesSerialize"></BinaryString>
			<SecurityCapabilities name="Capabilities">0</SecurityCapabilities>
			<bool name="DefinesCapabilities">false</bool>
			<string name="Name">Main</string>
			<int64 name="SourceAssetId">-1</int64>
			<BinaryString name="Tags"></BinaryString>
		</Properties>
	</Item>
</roblox>